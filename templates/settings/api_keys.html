{% extends "./base.html" %}

{%- import "../components/macros.html" as components -%}

{% block main %}
{# <div>
    <h1>Showing your api keys</h1>
    {% for key in key_infos %}
    <span> {{ key.name }} </span>
    {% endfor %}
</div> #}

<section class="px-5 w-full">
    <div>
        {#
        <NavigateBack href="/settings" to="settings" /> #}
        {% call components::navigate_back("/settings", "Settings") %}
        <h1 class="font-bold text-3xl text-text-100 py-2">API Keys</h1>
        <p class="max-w-3xl">
            An API key can be used by third-party applications to improve your
            experience.
        </p>
    </div>

    <div class="w-full mt-6">
        <div class="bg-background-50 rounded-sm border border-background-200 w-full ">
            <div class="flex items-center border-b border-background-200 py-3.5 px-6">
                <div class="flex-grow">
                    <h2 class="font-medium text-xl text-text-100">
                        ManeKani API Keys
                    </h2>
                </div>
                <form id="generate-api-key">
                    <a href="/settings/api-keys/create" class="wk-btn wk-btn-primary">
                        Generate new API key
                    </a>
                </form>
            </div>
            <div class="w-full overflow-x-auto">
                <div class="h-auto overflow-y-visible">
                    <table class="w-full text-left text-sm text-text-500">
                        <thead
                            class="text-xs text-text-300 font-medium bg-background-100 border-b border-background-200">
                            <tr>
                                <th scope="col" class="px-6 py-4 whitespace-nowrap">
                                    Name
                                </th>
                                <th scope="col" class="px-6 py-4 whitespace-nowrap">
                                    Prefix
                                </th>
                                <th scope="col" class="px-6 py-4 whitespace-nowrap">
                                    Created At
                                </th>
                                <th scope="col" class="px-6 py-4 whitespace-nowrap">
                                    Status
                                </th>
                                <th scope="col" class="px-6 py-4 whitespace-nowrap">
                                    Last Used
                                </th>
                                <th scope="col" class="px-6 py-4 whitespace-nowrap">
                                    <span class="sr-only">More</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="api-keys-content" class="divide-y divide-background-200">
                            {%if key_infos.is_empty()%}
                            <tr class="bg-background-50 text-left hover:bg-background-100 text-text-400">
                                <td class="px-6 py-3 text-center" colspan="6">
                                    No API keys found
                                </td>
                            </tr>
                            {%else%}
                            {% for key_info in key_infos %}
                            <tr class="bg-background-50 text-left hover:bg-background-100 text-text-400">
                                <th scope="row" class="px-6 py-3 font-medium text-text-100 whitespace-nowrap">
                                    {{ key_info.name }}
                                </th>
                                <td class="px-6 py-3 text-text-100 font-mono">
                                    <pre>{{ key_info.prefix }}</pre>
                                </td>
                                <td class="px-6 py-3 first-letter:uppercase">
                                    <span title="{{ key_info.created_at.rfc }}"> {{ key_info.created_at.short }} </span>
                                </td>
                                <td class="px-6 py-3">
                                    <span class="text-green-800 bg-green-100 rounded-sm px-2.5 font-medium py-1.5">
                                        {# tk.isActive ? "text-green-800 bg-green-100" : "text-amber-800
                                        bg-amber-100", "rounded-sm px-2.5 font-medium py-1.5", #} Active
                                    </span>
                                </td>
                                <td class="px-6 py-3">
                                    {% match key_info.used_at %}
                                    {% when Some with (used_at) %}
                                    <span title='{{ used_at.rfc }}'> {{ used_at.short }} </span>
                                    {% when None %} Never
                                    {% endmatch %}
                                </td>
                                <td class="px-6 py-3 flex gap-2 justify-end">
                                    <a class="wk-btn-sm wk-btn-secondary"
                                        href="/settings/api-keys/manage/{{key_info.id}}">Manage</a>
                                    <button class="wk-btn-sm wk-btn-red"
                                        hx-delete="/settings/api-keys/manage/{{key_info.id}}"
                                        hx-confirm="Are you sure you want to delete this API key?"
                                        hx-target="closest tr" hx-swap="outerHTML">Delete</button>
                                </td>
                            </tr>
                            {% endfor %}
                            {%endif%}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}