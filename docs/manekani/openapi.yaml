openapi: 3.0.1
info:
  title: ManeKani API
  description: ManeKani API.
  # termsOfService: http://swagger.io/terms/
  # contact:
  #   name: API Support
  #   url: http://www.swagger.io/support
  #   email: sixels@protonmail.com
  # license:
  #   name: Apache 2.0
  #   url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: "1.0"
servers:
  - url: http://127.0.0.1:8080
tags:
  - name: metric
    description: API health status
  - name: internal
    description: Internal API functionalities
  - name: subject
    description: Subjects API functionalities
  - name: deck
    description: Decks API functionalities
  - name: token
    description: Tokens API functionalities
  - name: user
    description: User related
# paths:
#   /health:
#     get:
#       tags:
#         - metric
#       summary: Check the health status of the server.
#       description: Check the health status of the server.
#       operationId: check-health
#       responses:
#         200:
#           description: OK
#           content:
#             application/json:
#               schema:
#                 type: object
#                 additionalProperties:
#                   type: object
components:
  schemas:
    common.Response:
      type: object
      required:
        - code
        - data
      properties:
        code:
          type: integer
        data:
          type: object
    common.ErrorResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
    subject.Model:
      type: object
      required:
        - id
        - created_at
        - updated_at
        - kind
        - level
        - name
        - slug
        - priority
        - resources
        - study_data
        - dependencies
        - dependents
        - similars
        - deck
        - owner
      properties:
        additional_study_data:
          type: object
        created_at:
          type: string
        deck:
          type: string
          format: uuid
        dependencies:
          type: array
          items:
            type: string
            format: uuid
        dependents:
          type: array
          items:
            type: string
            format: uuid
        id:
          type: string
          format: uuid
        kind:
          type: string
        level:
          type: integer
          format: int32
        name:
          type: string
        owner:
          type: string
        priority:
          type: integer
          format: uint8
        resources:
          type: array
          items:
            $ref: "#/components/schemas/subject.Resource"
        similars:
          type: array
          items:
            type: string
            format: uuid
        slug:
          type: string
        study_data:
          type: array
          items:
            $ref: "#/components/schemas/subject.StudyData"
        updated_at:
          type: string
        value:
          type: string
        value_image:
          type: string
    subject.StudyData:
      type: object
      required:
        - items
        - kind
        - mnemonic
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/subject.StudyItem"
        kind:
          type: string
        mnemonic:
          type: string
    subject.StudyItem:
      type: object
      required:
        - value
        - is_primary
        - is_valid_answer
        - is_hidden
      properties:
        category:
          type: string
        is_hidden:
          type: boolean
        is_primary:
          type: boolean
        is_valid_answer:
          type: boolean
        resource:
          type: string
        value:
          type: string
    subject.Resource:
      type: object
      properties:
        metadata:
          type: object
          additionalProperties:
            type: string
        url:
          type: string
    subject.CreateRequest:
      type: object
      required:
        - deck
        - kind
        - level
        - priority
        - name
        - slug
      properties:
        deck:
          type: string
          format: uuid
        dependencies:
          type: array
          items:
            type: string
            format: uuid
        dependents:
          type: array
          items:
            type: string
            format: uuid
        kind:
          type: string
        level:
          type: integer
          format: int32
        name:
          type: string
        priority:
          type: integer
          format: uint8
        similars:
          type: array
          items:
            type: string
            format: uuid
        slug:
          type: string
        value:
          type: string
        value_image:
          type: string
          description: The subject value image
          format: binary
        resource[]:
          type: array
          description: The subject resources
          items:
            type: string
            format: binary
        resources_meta:
          type: array
          description: Resources metadatas
          items:
            type: object
            additionalProperties:
              type: string
        study_data:
          type: array
          items:
            $ref: "#/components/schemas/subject.StudyData"
        additional_study_data:
          type: object
    subject.CreateResponse:
      $ref: "#/components/schemas/subject.Model"
    subject.GetResponse:
      $ref: "#/components/schemas/subject.Model"
    subject.GetAllResponse:
      type: array
      items:
        type: object
        required:
          - id
          - kind
          - level
          - name
          - slug
          - priority
          - study_data
          - dependencies
          - dependents
          - similars
          - deck
          - owner
        properties:
          deck:
            type: string
            format: uuid
          dependencies:
            type: array
            items:
              type: string
              format: uuid
          dependents:
            type: array
            items:
              type: string
              format: uuid
          id:
            type: string
            format: uuid
          kind:
            type: string
          level:
            type: integer
            format: int32
          name:
            type: string
          owner:
            type: string
          priority:
            type: integer
            format: uint8
          similars:
            type: array
            items:
              type: string
              format: uuid
          slug:
            type: string
          study_data:
            type: array
            items:
              $ref: "#/components/schemas/subject.StudyData"
          value:
            type: string
          value_image:
            type: string
    subject.UpdateRequest:
      type: object
      properties:
        additional_study_data:
          type: object
        dependencies:
          type: array
          items:
            type: string
            format: uuid
        dependents:
          type: array
          items:
            type: string
            format: uuid
        kind:
          type: string
        level:
          type: integer
          format: int32
        name:
          type: string
        priority:
          type: integer
          format: uint8
        resources:
          type: array
          items:
            $ref: "#/components/schemas/subject.Resource"
        similars:
          type: array
          items:
            type: string
            format: uuid
        slug:
          type: string
        study_data:
          type: array
          items:
            $ref: "#/components/schemas/subject.StudyData"
        value:
          type: string
        value_image:
          type: string
    subject.UpdateResponse:
      $ref: "#/components/schemas/subject.Model"
    deck.Model:
      type: object
      properties:
        id:
          type: string
          format: uuid
        created_at:
          type: string
        updated_at:
          type: string
        name:
          type: string
        description:
          type: string
        subjects:
          type: array
          items:
            type: string
        owner:
          type: string
    deck.CreateRequest:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
        description:
          type: string
    deck.CreateResponse:
      $ref: "#/components/schemas/deck.Model"
    deck.GetResponse:
      $ref: "#/components/schemas/deck.Model"
    deck.GetAllResponse:
      type: object
      properties:
        decks:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              name:
                type: string
              description:
                type: string
              owner:
                type: string
    token.Claims:
      type: object
      properties:
        deck_create:
          type: boolean
        deck_delete:
          type: boolean
        deck_update:
          type: boolean
        review_create:
          type: boolean
        study_material_create:
          type: boolean
        study_material_update:
          type: boolean
        subject_create:
          type: boolean
        subject_delete:
          type: boolean
        subject_update:
          type: boolean
        user_delete:
          type: boolean
        user_update:
          type: boolean
    token.Status:
      type: string
      enum:
        - active
        - frozen
      x-enum-varnames:
        - TokenStatusActive
        - TokenStatusFrozen
    token.CreateRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        permissions:
          $ref: "#/components/schemas/token.Claims"
    token.CreateResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        prefix:
          type: string
        token:
          type: string
        claims:
          $ref: "#/components/schemas/token.Claims"
        status:
          $ref: "#/components/schemas/token.Status"
        used_at:
          type: string
    token.GetResponse:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        name:
          type: string
        claims:
          $ref: "#/components/schemas/token.Claims"
        prefix:
          type: string
        status:
          $ref: "#/components/schemas/token.Status"
        used_at:
          type: string
    token.GetAllResponse:
      type: array
      items:
        type: object
        required:
          - id
          - name
          - prefix
          - status
        properties:
          id:
            type: string
          name:
            type: string
          claims:
            $ref: "#/components/schemas/token.Claims"
          prefix:
            type: string
          status:
            $ref: "#/components/schemas/token.Status"
          used_at:
            type: string
  securitySchemes:
    ApiKey:
      type: apiKey
      description: API key authentication
      name: Authorization
      in: header
    Login:
      type: apiKey
      description: Login at http://127.0.0.1:4455/login and copy the contents of the 'ory_kratos_session' cookie
      name: ory_kratos_session
      in: cookie
paths:
  /api/v1/subjects:
    get:
      tags:
        - subject
      summary: Query all subjects
      description: Return a list of all subjects
      operationId: get-subjects
      parameters:
        - name: decks
          in: query
          schema:
            type: string
        - name: ids
          in: query
          schema:
            type: string
        - name: kinds
          in: query
          schema:
            type: string
        - name: levels
          in: query
          schema:
            type: string
        - name: owners
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
        - name: slugs
          in: query
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: "#/components/schemas/common.Response"
                    - type: object
                      properties:
                        data:
                          $ref: "#/components/schemas/subject.GetAllResponse"
    post:
      tags:
        - subject
      summary: Create a new subject
      description: Creates a subject with the given values
      operationId: create-subject
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/subject.CreateRequest"
        required: true
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/subject.CreateResponse"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        403:
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
      security:
        - ApiKey: ["subject:create"]
        - Login: []
  /api/v1/subjects/{id}:
    get:
      tags:
        - subject
      summary: Query a subject
      description: Search a subject by its id
      operationId: get-subject
      parameters:
        - name: id
          in: path
          description: Subject ID
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/subject.GetResponse"
    delete:
      tags:
        - subject
      summary: Delete a subject
      description: Delete a subject by its id
      operationId: delete-subject
      parameters:
        - name: id
          in: path
          description: Subject ID
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content: {}
      security:
        - ApiKey: ["subject:delete"]
        - Login: []
    patch:
      tags:
        - subject
      summary: Update a subject
      description: Update a subject with the given values
      operationId: update-subject
      parameters:
        - name: id
          in: path
          description: Subject ID
          required: true
          schema:
            type: string
      requestBody:
        description: Subject fields to update
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/subject.UpdateRequest"
        required: true
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/subject.UpdateResponse"
      security:
        - ApiKey: ["subject:update"]
        - Login: []
      x-codegen-request-body-name: subject
  /api/v1/decks:
    get:
      tags:
        - deck
      summary: Query all decks
      description: Return a list of all decks
      operationId: get-decks
      parameters:
        - name: ids
          in: query
          schema:
            type: string
        - name: subjects
          in: query
          schema:
            type: string
        - name: owners
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
        - name: names
          in: query
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/deck.GetAllResponse"
    post:
      tags:
        - deck
      summary: Create a new deck
      description: Creates a new deck with the given values
      operationId: create-deck
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/deck.CreateRequest"
        required: true
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/deck.CreateResponse"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        403:
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
      security:
        - ApiKey: ["deck:create"]
        - Login: []
  /api/v1/decks/{id}:
    get:
      tags:
        - deck
      summary: Query a deck
      description: Search a deck by its id
      operationId: get-deck
      parameters:
        - name: id
          in: path
          description: Deck ID
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/deck.GetResponse"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        404:
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
  "/auth/validate-token":
    get:
      # x-internal: true
      tags:
        - internal
      summary: Validate a token
      operationId: validate-token
      parameters:
        - name: Authorization
          in: header
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
  /api/tokens:
    get:
      x-internal: true
      tags:
        - token
      summary: Get all user's API tokens
      description: Get all user's API tokens
      operationId: get-tokens
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/token.GetAllResponse"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
      security:
        - Login: []
    post:
      x-internal: true
      tags:
        - token
      summary: Create a new API token
      description: Creates a new API token with the given permissions
      operationId: create-token
      requestBody:
        description: The API token options
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/token.CreateRequest"
        required: true
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/common.Response"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/token.CreateResponse"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
      security:
        - Login: []
      x-codegen-request-body-name: request
  /api/tokens/{id}:
    delete:
      x-internal: true
      tags:
        - token
      summary: Delete an API token
      description: Deletes an API token by the given ID
      operationId: delete-token
      parameters:
        - name: id
          in: path
          description: The API token ID
          required: true
          schema:
            type: string
      responses:
        200:
          description: Ok
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.Response"
        400:
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/common.ErrorResponse"
      security:
        - Login: []
